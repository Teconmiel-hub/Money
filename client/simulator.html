<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Simulator - Money</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-left">
            <a href="index.html" class="nav-logo">Money</a>
            <div class="nav-links">
                <a href="concepts.html" class="nav-link">Concepts</a>
                <a href="guidance.html" class="nav-link">Guidance</a>
                <a href="simulator.html" class="nav-link">Simulator</a>
            </div>
        </div>
        <div class="nav-right">
            <div class="user-info">
                <div class="user-avatar">JD</div>
                <span class="user-name">John Doe</span>
            </div>
            <button class="btn-logout" onclick="handleLogout()">Logout</button>
        </div>
    </nav>

    <!-- Header -->
    <header class="header">
        <h1>Stock Market Simulator</h1>
        <p>Practice trading with virtual money in a risk-free environment</p>
    </header>

    <!-- Content -->
    <div class="container">
        <!-- Dashboard -->
        <div class="simulator-dashboard">
            <div class="dashboard-card">
                <p class="dashboard-label">Portfolio Value</p>
                <p class="dashboard-value" id="portfolioValue">$10,000.00</p>
            </div>
            <div class="dashboard-card">
                <p class="dashboard-label">Cash Available</p>
                <p class="dashboard-value" id="cashAvailable">$10,000.00</p>
            </div>
            <div class="dashboard-card">
                <p class="dashboard-label">Total Gain/Loss</p>
                <p class="dashboard-value positive" id="totalGainLoss">$0.00</p>
            </div>
            <div class="dashboard-card">
                <p class="dashboard-label">Return %</p>
                <p class="dashboard-value positive" id="returnPercent">0.00%</p>
            </div>
        </div>

        <!-- Portfolio Holdings -->
        <div class="portfolio-section">
            <h2 class="section-title">Your Holdings</h2>
            <table class="holdings-table">
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Shares</th>
                        <th>Avg Cost</th>
                        <th>Current Price</th>
                        <th>Total Value</th>
                        <th>Gain/Loss</th>
                    </tr>
                </thead>
                <tbody id="holdingsTableBody">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray-500);">
                            No holdings yet. Execute your first trade below to get started!
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Trade Section -->
        <div class="trade-section">
            <h2 class="section-title">Execute Trade</h2>
            
            <!-- Alert Messages -->
            <div class="alert alert-info" id="infoAlert" style="display: none;"></div>
            <div class="alert alert-success" id="successAlert" style="display: none;"></div>
            <div class="alert alert-error" id="errorAlert" style="display: none;"></div>
            
            <div class="trade-form">
                <div class="form-group">
                    <label class="form-label">Stock Symbol</label>
                    <input type="text" class="form-input" id="stockSymbol" placeholder="e.g., AAPL, GOOGL, MSFT" style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label class="form-label">Number of Shares</label>
                    <input type="number" class="form-input" id="numShares" placeholder="Enter quantity" min="1">
                </div>
            </div>
            
            <div class="trade-buttons">
                <button class="btn btn-success" onclick="executeTrade('buy')">Buy Stock</button>
                <button class="btn btn-danger" onclick="executeTrade('sell')">Sell Stock</button>
            </div>
            
            <div style="margin-top: 24px; padding: 20px; background: var(--accent-lighter); border-radius: 12px;">
                <h4 style="color: var(--primary-navy); margin-bottom: 12px;">Stock Price Information</h4>
                <p id="stockPriceInfo" style="color: var(--gray-700); font-size: 14px;">
                    Enter a stock symbol to see current price information.
                </p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 Money App. All rights reserved.</p>
    </footer>

    <script>
        // Portfolio state
        let cash = 10000;
        let holdings = {};
        
        // Mock stock prices (in a real app, this would come from an API)
        const stockPrices = {
            'AAPL': 175.50,
            'GOOGL': 135.80,
            'MSFT': 380.25,
            'AMZN': 145.90,
            'TSLA': 242.15,
            'META': 355.60,
            'NVDA': 495.30,
            'JPM': 155.70,
            'V': 260.85,
            'WMT': 165.40
        };

        function formatCurrency(amount) {
            return '$' + amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        function showAlert(type, message) {
            // Hide all alerts first
            document.getElementById('infoAlert').style.display = 'none';
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';

            // Show the appropriate alert
            const alertId = type + 'Alert';
            const alertElement = document.getElementById(alertId);
            alertElement.textContent = message;
            alertElement.style.display = 'block';

            // Hide after 5 seconds
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }

        function updateDashboard() {
            // Calculate portfolio value
            let stockValue = 0;
            for (let symbol in holdings) {
                stockValue += holdings[symbol].shares * stockPrices[symbol];
            }
            
            const portfolioValue = cash + stockValue;
            const gainLoss = portfolioValue - 10000;
            const returnPercent = ((gainLoss / 10000) * 100).toFixed(2);

            // Update dashboard
            document.getElementById('portfolioValue').textContent = formatCurrency(portfolioValue);
            document.getElementById('cashAvailable').textContent = formatCurrency(cash);
            document.getElementById('totalGainLoss').textContent = formatCurrency(gainLoss);
            document.getElementById('returnPercent').textContent = returnPercent + '%';

            // Update gain/loss styling
            const gainLossElement = document.getElementById('totalGainLoss');
            const returnElement = document.getElementById('returnPercent');
            
            if (gainLoss >= 0) {
                gainLossElement.classList.remove('negative');
                gainLossElement.classList.add('positive');
                returnElement.classList.remove('negative');
                returnElement.classList.add('positive');
            } else {
                gainLossElement.classList.remove('positive');
                gainLossElement.classList.add('negative');
                returnElement.classList.remove('positive');
                returnElement.classList.add('negative');
            }
        }

        function updateHoldingsTable() {
            const tbody = document.getElementById('holdingsTableBody');
            tbody.innerHTML = '';

            if (Object.keys(holdings).length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray-500);">
                            No holdings yet. Execute your first trade to get started!
                        </td>
                    </tr>
                `;
                return;
            }

            for (let symbol in holdings) {
                const holding = holdings[symbol];
                const currentPrice = stockPrices[symbol];
                const totalValue = holding.shares * currentPrice;
                const gainLoss = totalValue - (holding.shares * holding.avgCost);
                const gainLossClass = gainLoss >= 0 ? 'positive' : 'negative';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="stock-symbol">${symbol}</span></td>
                    <td>${holding.shares}</td>
                    <td>${formatCurrency(holding.avgCost)}</td>
                    <td><span class="stock-price">${formatCurrency(currentPrice)}</span></td>
                    <td>${formatCurrency(totalValue)}</td>
                    <td class="${gainLossClass}">${gainLoss >= 0 ? '+' : ''}${formatCurrency(gainLoss)}</td>
                `;
                tbody.appendChild(row);
            }
        }

        function executeTrade(action) {
            const symbol = document.getElementById('stockSymbol').value.toUpperCase().trim();
            const shares = parseInt(document.getElementById('numShares').value);

            // Validation
            if (!symbol) {
                showAlert('error', 'Please enter a stock symbol.');
                return;
            }

            if (!stockPrices[symbol]) {
                showAlert('error', `Stock symbol "${symbol}" not found. Available symbols: ${Object.keys(stockPrices).join(', ')}`);
                return;
            }

            if (!shares || shares <= 0) {
                showAlert('error', 'Please enter a valid number of shares.');
                return;
            }

            const price = stockPrices[symbol];
            const totalCost = shares * price;

            if (action === 'buy') {
                // Check if enough cash
                if (totalCost > cash) {
                    showAlert('error', `Insufficient funds. You need ${formatCurrency(totalCost)} but only have ${formatCurrency(cash)}.`);
                    return;
                }

                // Execute buy
                cash -= totalCost;

                if (holdings[symbol]) {
                    // Update existing holding
                    const totalShares = holdings[symbol].shares + shares;
                    const totalCostBasis = (holdings[symbol].shares * holdings[symbol].avgCost) + totalCost;
                    holdings[symbol].avgCost = totalCostBasis / totalShares;
                    holdings[symbol].shares = totalShares;
                } else {
                    // Create new holding
                    holdings[symbol] = {
                        shares: shares,
                        avgCost: price
                    };
                }

                showAlert('success', `Successfully bought ${shares} shares of ${symbol} at ${formatCurrency(price)} per share.`);

            } else if (action === 'sell') {
                // Check if holding exists and has enough shares
                if (!holdings[symbol]) {
                    showAlert('error', `You don't own any shares of ${symbol}.`);
                    return;
                }

                if (holdings[symbol].shares < shares) {
                    showAlert('error', `You only own ${holdings[symbol].shares} shares of ${symbol}.`);
                    return;
                }

                // Execute sell
                cash += totalCost;
                holdings[symbol].shares -= shares;

                // Remove holding if all shares sold
                if (holdings[symbol].shares === 0) {
                    delete holdings[symbol];
                }

                showAlert('success', `Successfully sold ${shares} shares of ${symbol} at ${formatCurrency(price)} per share.`);
            }

            // Update display
            updateDashboard();
            updateHoldingsTable();

            // Clear form
            document.getElementById('stockSymbol').value = '';
            document.getElementById('numShares').value = '';
            document.getElementById('stockPriceInfo').innerHTML = 'Enter a stock symbol to see current price information.';
        }

        // Stock symbol lookup
        document.getElementById('stockSymbol').addEventListener('input', function() {
            const symbol = this.value.toUpperCase().trim();
            const infoElement = document.getElementById('stockPriceInfo');

            if (symbol && stockPrices[symbol]) {
                const price = stockPrices[symbol];
                infoElement.innerHTML = `
                    <strong>${symbol}</strong>: Current price is ${formatCurrency(price)} per share.<br>
                    <span style="color: var(--gray-600); font-size: 13px;">This is simulated data for educational purposes.</span>
                `;
            } else if (symbol) {
                infoElement.innerHTML = `
                    Stock symbol "${symbol}" not found.<br>
                    <span style="color: var(--gray-600); font-size: 13px;">Available symbols: ${Object.keys(stockPrices).join(', ')}</span>
                `;
            } else {
                infoElement.innerHTML = 'Enter a stock symbol to see current price information.';
            }
        });

        function handleLogout() {
            if (confirm('Are you sure you want to logout? Your portfolio progress will be lost.')) {
                window.location.href = 'login.html';
            }
        }

        // Initialize
        updateDashboard();
        updateHoldingsTable();
    </script>
</body>
</html>